# networking
## networking basics
```bash
# get interfaces
ip link
# get ip address
ip addr
# add default route
ip route add default via 192.168.2.1 
ip route add 0.0.0.0/0 via 192.168.2.1
```
- router
    - help connect different networks
    - different ips on different interfaces
- gateway
    - door to the other network
- packet forwarding between interfaces are not enabled by default for security reasons
- to achieve this, run 
```bash
# check if forwarding is enabled
cat /proc/sys/net/ipv4/ip_forward
sysctl net.ipv4.ip_forward
sysctl -w net.ipv4.ip_forward=1
  
```
## DNS
- /etc/hosts for local entries
- /etc/resolv.conf for dns servers
- /etc/nsswitch.conf for order of lookups
- order is
    - hosts
    - networks 

- suffix is added to the hostname to form the FQDN

## Coredns
- for internal dns use
- uses Corefile for configuration
- can configured Corefile to use local /etc/hosts file via 
```bash
cat > Corefile <<EOF
.:53 {
    hosts {
        fallthrough
    }
    forward .
```
- https://coredns.io/plugins/kubernetes/
## Network namespaces
- like rooms in a house
```bash
# create network ns
ip netns add red
# list network ns
ip netns list
# execute command in network ns
ip netns exec red ip link
# alternative
ip -n red link

# arp command is for layer 2
arp
# run arp for ns
ip netns exec red arp
# run route for ns
ip netns exec red route

# create a pipe between two ns
ip link add veth-red type veth peer name veth-blue
# attach one end to red ns
ip link set veth-red netsh red
ip link set veth-blue netsh blue
# assign ip to the veth interfaces
ip -n red addr add 192.168.15.1 dev veth-red
ip -n blue addr add 192.168.15.2 dev veth-blue
# up the links
ip -n red link set veth-red up
ip -n blue link set veth-blue up

# delete link
ip -n red link del veth-red
ip -n blue link del veth-blue

# create a vswitch
ip link add v-net0 type bridge
# set vswitch up
ip link set dev v-net0 -up

# create bridge between vswitch and veth
ip link add veth-red type veth peer name veth-red-br
ip link add veth-blue type veth peer name veth-blue-br
# attach other end 
ip link set veth-red netns red
ip link set veth-blue netns blue
# attach bridge to vswitch
ip link set veth-red-br master v-net0
ip link set veth-blue-br master v-net0
# set addresses to veth
ip -n red addr add 192.168.15.1 dev veth-red
ip -n blue addr add 192.168.15.2 dev veth-blue
# up the links
ip -n red link set veth-red up
ip -n blue link set veth-blue up
# add ip to vswitch
ip addr add 192.168.15.5/24 dev v-net0




```